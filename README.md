# Thousand Island
**Dressing for Prawn**

[Prawn](https://github.com/prawnpdf/prawn) is awesome. It has some amazing functionality, and you can get anything that's in your head onto a PDF document with some Ruby code. For me though, as wonderful as that is, I normally only need a repeating header and footer, and then some text and maybe a table in between them. This is where **Thousand Island** comes in. A few simple commands should get you set up with a template that you can use application wide, and then all you need to worry about is getting the right content into the document.

## Installation

Add this line to your application's Gemfile:

    gem 'thousand_island'

And then execute:

    $ bundle

Or install it yourself as:

    $ gem install thousand_island

## Usage

### Initialise
Running:

    $ thousand_island init

    # or the shorter version:

    $ k_island init
will create the directory structure for your PDF files and supporting files.

> Nb. Use k_island and thousand_island interchangeably. Clarity is good, less typing is good, here you have both options.

The directory structure is as follows:

    ├── app/
    │   └── pdf_builders/
    │       └── templates/
    │           └── .keep
    │       └── support/
    │           └── .keep

* **app/pdf_builders/** - Your main classes that generate the actual pdf file go in this directory
* **app/pdf_builders/templates** - The template files that are reused and contain the style information belong here
* **app/pdf_builders/support** - This is where you can keep files that are used to generate your PDFs. Things like image files for the company logo, custom icons, that sort of thing. You don't have to keep them here if you don't want to.

If you don't run the `init` command, the folders will be created when a template or builder is generated, unless a different path is specified (see below)

### Creating a Template

You'll need a starting point for your PDF documents. It's likely (but not enforced!) that you'll create a template for the entire application, which ensures a consistent style across all PDFs your application creates. Running:

    $ thousand_island template my_template

    # or the shorter version:

    $ k_island template my_template
will create a file that has some commented options with defaults and explanations for how you can style your template. The default path to the file is `app/pdf_builders/templates/my_template.rb`

You may also specify a custom path, if you don't like the defaults. For instance:

    $ k_island template my_template --path=lib/pdf_templates


Have a look at the file and the commented defaults. Here's where you set the basic layout for your header and footer. Anything set here can also be overridden by a PDF generator that uses this template.

### Creating a Builder

The class that is used to build the final will be generated by the command:

    $ k_island builder my_builder
The file path will be `app/pdf_builders/my_builder.rb`, unless you use the `path=` option (see 'Creating a Template')

As with the template, check out the comments and defaults in the new file itself.

The builder needs to be given data, and this will be rendered by the `body` method. This is where you will do most of the work, as the `body` method is empty to begin with.

### Using the Builder in a Rails Application

Your Controller can look something like this:

```ruby
def show
    @thing = Thing.find(params[:id])
    respond_to do |format|
      format.html
      format.pdf do
        data = { thing: @thing }  # nb. How you structure this is up to you, it's your Class!!
        builder = MyBuilder.new(data)
        send_data builder.build, filename: builder.filename,
          type: "application/pdf",
          disposition: "inline" # Leave blank to render as a download
      end
    end
  end
```

If your controller for getting the data for a PDF is that simple, then you're pretty lucky. Normally we're going to want a PDF file to render a few things at once, so you might build a service object that formats the data as follows:

```ruby
def show
    respond_to do |format|
      format.html do
        @thing_for_html_view = Thing.find(params[:id])
      end
      format.pdf do
        builder = ThingServiceObject.new(params) # The service object does it's thing and returns the Builder
        send_data builder.build, filename: builder.filename,
          type: "application/pdf",
          disposition: "inline" # Leave blank to render as a download
      end
    end
  end
```

These are only suggestions, as you can probably tell there is nothing tying you down to a particular way of building and delivering the document. You might even want to save it to the file system, or upload to S3. There is nothing stopping you from doing that, whether you do it by customizing the `build` method, or by uploading in a background task after rendering to the browser.

## Contributing

1. Fork it
2. Create your feature branch (`git checkout -b my-new-feature`)
3. Commit your changes (`git commit -am 'Add some feature'`)
4. Push to the branch (`git push origin my-new-feature`)
5. Create new Pull Request
